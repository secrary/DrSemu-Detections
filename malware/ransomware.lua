-- json = require "json"
utils = require "utils"

-- detection logic
function check(report_directory)

    local status = "CLEAN"

    -- open the first json file and read content
    local first_dynamic = utils.get_first_process_json(report_directory)
    local first_static = utils.get_first_static(report_directory)

-- 
--  your code starts from here
-- 
    -- static information
    local is_x86 = false
    if first_static ~= nil then
        is_x86 = first_static.generic.is_x86
    end

    -- dynamic information

    -- if a sample renames more than 10 files and creates more than 2 "readme" files
    if first_dynamic ~= nil then
        local rename_count = 0
        local readme_count = 0
        -- enumerate json
        for index, win_func in pairs(first_dynamic) do

            if win_func.NtSetInformationFile and win_func.NtSetInformationFile.FileRename then
                rename_count = rename_count + 1
            end

            if win_func.NtCreateFile and win_func.NtCreateFile.before then
                local file_path = win_func.NtCreateFile.before.file_path:lower()
                if file_path:find("readme", 1, true) then
                    readme_count = readme_count + 1
                end
            end

        end

        if rename_count > 10 and readme_count > 2 then
            return "Generic.Ransomware.DR"
        end
    end
    
    return status
end